<!DOCTYPE html>
<html lang="en">

  <head>
    <% include ./partials/head %>

    <style>
       
    .emp-profile{
        padding-right: 50%;
        margin-top: 3%;
        margin-bottom: 3%;
        border-radius: 0.5rem;
        background: aliceblue;
        margin-left:3%;
        margin-right: 10%; 
    }
    .profile-img img{
        width: 100%;
        height: 100%;
        border-radius: 5px;
    }
    .profile-img .file {
        position: relative;
        overflow: hidden;
        margin-top: -15%;
        width: 100%;
        border: none;
        border-radius: 3px;
        font-size: 18px;
        background: #212529b8;
    }
    .profile-img .file input {
        position: absolute;
        opacity: 0;
        right: 0;
        top: 0;
    }
    .profile-head h5{
        color: #333;
    }
    .profile-head h6{
        color: #0062cc;
    }
    .profile-edit-btn{
        border: none;
        border-radius: 1.5rem;
        width: 70%;
        padding: 2%;
        font-weight: 600;
        color: #6c757d;
        cursor: pointer;
    }
    .profile-head .nav-tabs{
        margin-bottom:1%;
    }
    .profile-head .nav-tabs .nav-link{
        font-weight:600;
        border: none;
        font-size: larger;
        font-style: oblique;
        font-size: 30px;
        margin-right: 10%;
    }
    .profile-head .nav-tabs .nav-link.active{
        border: none;
        border-bottom:2px solid #0062cc;
    }
    .profile-work p{
        font-size: 20px;
        color: #000000;
        font-weight: 600;
        margin-top: 10%;
    }
    .profile-work a{
        text-decoration: none;
        color: #000000;
        font-weight: 600;
        font-size: 14px;
    }
    .profile-work ul{
        list-style: none;
    }
    .profile-tab label{
        font-weight: 600;
        font-size: 20px;
    }
    .profile-tab p{
        font-weight: 600;
        font-size: 20px;
        color: #0062cc;
    }
    .profile-tab a{
        font-weight: 600;
        font-size: 20px;
        color: #0062cc;
    }
    #view { display: none; }
        </style>
    <link href="//maxcdn.bootstrapcdn.com/bootstrap/4.1.1/css/bootstrap.min.css" rel="stylesheet" >
    <script src="//maxcdn.bootstrapcdn.com/bootstrap/4.1.1/js/bootstrap.min.js"></script>
    <script src="//cdnjs.cloudflare.com/ajax/libs/jquery/3.2.1/jquery.min.js"></script>
</head>
<body id="page-top">
    <nav class="navbar navbar-expand-lg navbar-dark fixed-top " id="sideNav" style="background-color: #007bff;width:15.02%">
      <% include ./partials/navbar %>
    </nav>
    <div class="container emp-profile col-lg-10"  style="margin-left:10%;margin-top:4%;">
            <div class="row">
                <div class="col-md-4">
                <form method="POST" action="/profileupdate" id="myform">
                    <div class="profile-img">
                        <img src="https://encrypted-tbn0.gstatic.com/images?q=tbn:ANd9GcS52y5aInsxSm31CvHOFHWujqUx_wWTS9iM6s7BAm21oEN_RiGoog" alt="" />  
                            <div class="file btn btn-lg btn-primary">
                            Change Photo
                            <input type="file"  id="myinput" name="profile" />
                        </div>                                                      
                    </div>
                </form>  
                </div>
                <div class="col-md-8">
                    <div class="profile-head">

                        <ul class="nav nav-tabs" id="myTab" role="tablist">
                            <li class="nav-item">
                                <a class="nav-link active" id="home-tab" data-toggle="tab" href="#home" role="tab" aria-controls="home" aria-selected="true">About</a>
                            </li>
                            <li class="nav-item">
                                <a class="nav-link" id="profile-tab" data-toggle="tab" href="#profile" role="tab" aria-controls="profile" aria-selected="false">Timeline</a>
                            </li>
                            <li class="nav-item">
                                <a class="nav-link" id="programs-tab" data-toggle="tab" href="#program" role="tab" aria-controls="program" aria-selected="false">Programs</a>
                            </li>
                        </ul>
                    </div>
                </div>

            </div>
            <div class="row">
                <div class="col-md-4">
                    <div class="profile-work">
                        <p>Email</p>
                        <a><%= data.email %></a>
                        <p>Phone</p>
                        <a><%= data.phone %></a>
                        <p>Address</p>
                        <a><%= data.address %></a>
                    </div>
                </div>
                <div class="col-md-8">
                    <div class="tab-content profile-tab" id="myTabContent">
                        <div class="tab-pane fade show active" id="home" role="tabpanel" aria-labelledby="home-tab">
                                <% var fullname = data.firstname +  " " + data.middlename + " " + data.lastname; %>
                                    <div class="row">
                                        <div class="col-md-6">
                                            <label>Name</label>
                                        </div>
                                        <div class="col-md-6">
                                            <p><%= fullname %>  </p>
                                        </div>
                                    </div></br>
                                    <div class="row">
                                        <div class="col-md-6">
                                            <label>Profession</label>
                                        </div>
                                        <div class="col-md-6">
                                            <p><%= data.title %></p>
                                        </div>
                                    </div></br>
                                    <div class="row">
                                        <div class="col-md-6">
                                            <label>Department</label>
                                        </div>
                                        <div class="col-md-6">
                                            <p><%= data.dept %></p>
                                        </div>
                                    </div></br>
                                    <div class="row">
                                        <div class="col-md-6">
                                            <label>Area of Specialization</label>
                                        </div>
                                        <div class="col-md-6">
                                            <p><%= data.aos %></p>
                                        </div>
                                    </div></br>
                                
                                    <div class="row">
                                        <div class="col-md-6">
                                            <label>Experience</label>
                                        </div>
                                        <div class="col-md-6">
                                            <p>18 years</p>
                                        </div>
                                    </div></br>
                                   
                        </div>
                        <div class="tab-pane fade" id="profile" role="tabpanel" aria-labelledby="profile-tab">
                                    <div class="row">
                                        <div class="col-md-6">
                                            <label>Teaching Duration</label>
                                        </div>
                                        <div class="col-md-6">
                                            <p><%= data.tduration %></p>
                                        </div>
                                    </div></br>
                                    <div class="row">
                                        <div class="col-md-6">
                                            <label>Teaching Institute</label>
                                        </div>
                                        <div class="col-md-6">
                                            <p><%= data.tinstitute %></p>
                                        </div>
                                    </div></br>
                                    <div class="row">
                                        <div class="col-md-6">
                                            <label>Industry Duration</label>
                                        </div>
                                        <div class="col-md-6">
                                            <p><%= data.iduration %></p>
                                        </div>
                                    </div></br>
                                    <div class="row">
                                        <div class="col-md-6">
                                            <label>Industry</label>
                                        </div>
                                        <div class="col-md-6">
                                            <p><%= data.iinstitute %></p>
                                        </div>
                                    </div></br>
                                    
                        </div>
                        <div class="tab-pane fade" id="program" role="tabpanel" aria-labelledby="program-tab">
                            <div class="row">
                                <div class="col-md-6">
                                    <label>Faculty Development Program</label>
                                </div>
                                <div class="col-md-6">
                                    <a id="fdpa" name="fdpa" href=""></a>
                                </div>
                            </div></br>
                            <div class="row">
                                <div class="col-md-6">
                                    <label>Short Term Training Program</label>
                                </div>
                                <div class="col-md-6">
                                    <a id="sttpa" name="sttpa" href=""></a>
                                </div>
                            </div></br>
                            <div class="row">
                                <div class="col-md-6">
                                    <label>Conferences</label>
                                </div>
                                <div class="col-md-6">
                                    <a id="ca" rel="view" href="#view" class="link"></a>
                                </div>
                            </div></br>
                            <div class="row">
                                <div class="col-md-6">
                                    <label>Journals</label>
                                </div>
                                <div class="col-md-6">
                                    <a id="ja" name="ja" href=""></a>
                                </div>
                            </div></br>
                            <div class="row">
                                <div class="col-md-6">
                                    <label>Seminars/Workshops Attended</label>
                                </div>
                                <div class="col-md-6">
                                    <a id="swaa" name="swaa" href=""></a>
                                </div>
                            </div></br>
                            <div class="row">
                                <div class="col-md-6">
                                    <label>RnD/Consultancy</label>
                                </div>
                                <div class="col-md-6">
                                    <a id="rca" name="rca" href=""></a>
                                </div>
                            </div></br>
                            <div class="row">
                                <div class="col-md-6">
                                    <label>Programs Attended</label>
                                </div>
                                <div class="col-md-6">
                                    <a id="paa" name="paa" href=""></a>
                                </div>
                            </div></br>
                            
                </div>
                    </div>
                </div>
            </div>          
    </div>
    <div id="view" class="box">
    </div>
    <script>
            function number(url, id)
            {
                $.getJSON(url, function(data) {
                    var count = Object.keys(data).length;
                    $(id).text(count); 
                });
            }
           function create(rel, id, url, url1)
            {
                const request = new XMLHttpRequest();
                request.open('GET', url);
                request.send(); 
                
                request.onload = function() {
                if (request.status === 200) {
                    console.log("Success"); 
                    data = JSON.parse(request.response);
                    var col = [];
                    for (var i = 0; i < data.length; i++) {
                        for (var key in data[i]) {
                            if (col.indexOf(key) === -1) {
                                col.push(key);
                            }
                        }
                    }
                    console.log(col);
                    var table = document.createElement("table");
                    table.setAttribute("class", "table table-striped table-primary");
                    var tr = table.insertRow(-1); 
                    for (var i = 1; i < col.length; i++) {
                        var th = document.createElement("th");
                        th.innerHTML = col[i];
                        tr.appendChild(th);
                    }
                    var th = document.createElement("th");
                    th.innerHTML = 'Action';
                    tr.appendChild(th);
                    for (var i = 0; i < data.length; i++) {
                        tr = table.insertRow(-1);
                        var tabCell = ""
                        var id = 0;
                        for (var j = 1; j <= col.length; j++) {
                            tabCell = tr.insertCell(-1);
                            tabCell.innerHTML = data[i][col[j]];
                        }
                        id = data[i][col[0]];
                        tabCell.innerHTML = "<a class=\"btn btn-primary btn-xs\" href=\"" + url1 + id + "\"><i class=\"fa fa-edit\"></i></a> <a class=\"btn btn-danger btn-xs\" href=\"" +url1 + "delete/" + id + "\"><i class=\"fa fa-trash\"></i></a> <a class=\"btn btn-primary btn-xs\" href=\"" +url1 + "file-viewer/" + id + "\"><i class=\"fa fa-download\"></i></a>";
                        

                        
                    }
                    var divContainer = document.getElementById("view");
                    divContainer.innerHTML = "";
                    divContainer.appendChild(table);
                    } 
                };
                
                request.onerror = () => {
                console.log("error")
                };
            }
            number('/conference/files', '#fdpa');
            number('/conference/files', '#sttpa');
            number('/conference/files', '#ca');
            number('/conference/files', '#ja');
            number('/conference/files', '#swaa');
            number('/conference/files', '#rca');
            number('/conference/files', '#paa');      
            $('.link').click(function(){
                var id = $(this).attr("id");
                var rel = $(this).attr("rel");
                url = "";
                switch (id) {
                    case 'fdpa':
                        url = "/fdp/files";
                        url1 = "/fdp/";
                        break;
                    case 'sttpa':
                        url = "/sttp/files";
                        url1 = "/sttp/";
                        break;
                    case 'ca':
                        url = "/conference/files";
                        url1 = "/conference/";
                        break;
                    case 'ja':
                        url = "/journal/files";
                        url1 = "/journal/";
                        break;
                    case 'swaa':
                        url = "/semwork/files";
                        url1 = "/semwork/";
                        break;
                    case 'rca':
                        url = "/mrg/files";
                        url1 = "/mrg/";
                        break;
                    case 'paa':
                        url = "/progatt/files";
                        url1 = "/progatt/";
                        break;
                   
                }
                create(rel, id, url, url1);
                $('#'+rel).slideToggle('fast');
            });

    </script>
    <script>
        var form = document.getElementById('myform');
        var input = document.getElementById('myinput');

    var change_running = false;    
    input.addEventListener('change', function(){
    if(!change_running){
        setTimeout(function(){
            change_running = true;
            form.submit();
            change_running = false;     
        }, 300);
    }
});
    </script>

    <% include ./partials/bootjs %>


  </body>

</html>
