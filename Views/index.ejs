<!DOCTYPE html>
<html lang="en">

  <head>
    <% include ./partials/head %>

    <style>
       
    .emp-profile{
        padding-right: 50%;
        margin-top: 3%;
        margin-bottom: 3%;
        border-radius: 0.5rem;
        background: aliceblue;
        margin-left:3%;
        margin-right: 10%; 
    }
    .profile-img img{
        display: block;
        max-width:50%;
        max-width: 50%;;
        width: auto;
        height: auto;;
        border:1px solid pink;
    }
    .profile-head h5{
        color: #333;
    }
    .profile-head h6{
        color: #0062cc;
    }
    .profile-head .nav-tabs{
        margin-bottom:1%;
    }
    .profile-head .nav-tabs .nav-link{
        font-weight:600;
        border: none;
        font-size: larger;
        font-style: oblique;
        font-size: 30px;
        margin-right: 10%;
    }
    .profile-head .nav-tabs .nav-link.active{
        border: none;
        border-bottom:2px solid #0062cc;
    }
    .profile-work p{
        font-size: 20px;
        color: #000000;
        font-weight: 600;
        margin-top: 10%;
    }
    .profile-work a{
        text-decoration: none;
        color: #000000;
        font-weight: 600;
        font-size: 14px;
    }
    .profile-work ul{
        list-style: none;
    }
    .profile-tab label{
        font-weight: 600;
        font-size: 20px;
    }
    .profile-tab p{
        font-weight: 600;
        font-size: 20px;
        color: #0062cc;
    }
    .profile-tab a{
        font-weight: 600;
        font-size: 20px;
        color: #0062cc;
    }
    #view { display: none; }
        </style>
    <link href="//maxcdn.bootstrapcdn.com/bootstrap/4.1.1/css/bootstrap.min.css" rel="stylesheet" >
    <script src="//maxcdn.bootstrapcdn.com/bootstrap/4.1.1/js/bootstrap.min.js"></script>
    <script src="//cdnjs.cloudflare.com/ajax/libs/jquery/3.2.1/jquery.min.js"></script>
</head>
<body id="page-top">
    <nav class="navbar navbar-expand-lg navbar-dark fixed-top " id="sideNav" style="background-color: #007bff;width:15.02%">
      <% include ./partials/navbar %>
    </nav>
    <div class="container emp-profile col-lg-10"  style="margin-left:10%;margin-top:4%;">
            <div class="row">
                <div class="col-md-4">
                    <div class="profile-img">
                        <img src="/profileupdate"  id="profilepic" name="profilepic" onerror="this.src='/images/profile.jpg';" />  
                    </div>  
                </div>
                <div class="col-md-8">
                    <div class="profile-head">

                        <ul class="nav nav-tabs" id="myTab" role="tablist">
                            <li class="nav-item">
                                <a class="nav-link active" id="home-tab" data-toggle="tab" href="#home" role="tab" aria-controls="home" aria-selected="true">About</a>
                            </li>
                            <li class="nav-item">
                                <a class="nav-link" id="profile-tab" data-toggle="tab" href="#profile" role="tab" aria-controls="profile" aria-selected="false">Timeline</a>
                            </li>
                            <li class="nav-item">
                                <a class="nav-link" id="programs-tab" data-toggle="tab" href="#program" role="tab" aria-controls="program" aria-selected="false">Programs</a>
                            </li>
                        </ul>
                    </div>
                </div>

            </div>
            <div class="row">
                <div class="col-md-4">
                    <div class="profile-work">
                        <p>Email</p>
                        <a><%= data.email %></a>
                        <p>Phone</p>
                        <a><%= data.phone %></a>
                        <p>Address</p>
                        <a><%= data.address %></a>
                    </div>
                </div>
                <div class="col-md-8">
                    <div class="tab-content profile-tab" id="myTabContent">
                        <div class="tab-pane fade show active" id="home" role="tabpanel" aria-labelledby="home-tab">
                                <% var fullname = data.firstname +  " " + data.middlename + " " + data.lastname; %>
                                    <div class="row">
                                        <div class="col-md-6">
                                            <label>Name</label>
                                        </div>
                                        <div class="col-md-6">
                                            <p><%= fullname %>  </p>
                                        </div>
                                    </div></br>
                                    <div class="row">
                                        <div class="col-md-6">
                                            <label>Profession</label>
                                        </div>
                                        <div class="col-md-6">
                                            <p><%= data.title %></p>
                                        </div>
                                    </div></br>
                                    <div class="row">
                                        <div class="col-md-6">
                                            <label>Department</label>
                                        </div>
                                        <div class="col-md-6">
                                            <p><%= data.dept %></p>
                                        </div>
                                    </div></br>
                                    <div class="row">
                                        <div class="col-md-6">
                                            <label>Area of Specialization</label>
                                        </div>
                                        <div class="col-md-6">
                                            <p><%= data.aos %></p>
                                        </div>
                                    </div></br>
                                
                                   
                                   
                        </div>
                        <div class="tab-pane fade" id="profile" role="tabpanel" aria-labelledby="profile-tab">
                                    <div class="row">
                                        <div class="col-md-6">
                                            <label>Teaching Duration</label>
                                        </div>
                                        <div class="col-md-6">
                                            <p><%= data.tduration %></p>
                                        </div>
                                    </div></br>
                                    <div class="row">
                                        <div class="col-md-6">
                                            <label>Teaching Institute</label>
                                        </div>
                                        <div class="col-md-6">
                                            <p><%= data.tinstitute %></p>
                                        </div>
                                    </div></br>
                                    <div class="row">
                                        <div class="col-md-6">
                                            <label>Industry Duration</label>
                                        </div>
                                        <div class="col-md-6">
                                            <p><%= data.iduration %></p>
                                        </div>
                                    </div></br>
                                    <div class="row">
                                        <div class="col-md-6">
                                            <label>Industry</label>
                                        </div>
                                        <div class="col-md-6">
                                            <p><%= data.iinstitute %></p>
                                        </div>
                                    </div></br>
                                    
                        </div>
                        <div class="tab-pane fade" id="program" role="tabpanel" aria-labelledby="program-tab">
                            <div class="row">
                                <div class="col-md-6">
                                    <label>Faculty Development Program</label>
                                </div>
                                <div class="col-md-6">
                                    <a id="fdpa" rel="view" href="#view" class="link"></a>
                                </div>
                            </div></br>
                            <div class="row">
                                <div class="col-md-6">
                                    <label>Short Term Training Program</label>
                                </div>
                                <div class="col-md-6">
                                    <a id="sttpa" rel="view" href="#view" class="link"></a>
                                </div>
                            </div></br>
                            <div class="row">
                                <div class="col-md-6">
                                    <label>Conferences</label>
                                </div>
                                <div class="col-md-6">
                                    <a id="ca" rel="view" href="#view" class="link"></a>
                                </div>
                            </div></br>
                            <div class="row">
                                <div class="col-md-6">
                                    <label>Journals</label>
                                </div>
                                <div class="col-md-6">
                                    <a id="ja" rel="view" href="#view" class="link"></a>
                                </div>
                            </div></br>
                            <div class="row">
                                <div class="col-md-6">
                                    <label>Seminars/Workshops Attended</label>
                                </div>
                                <div class="col-md-6">
                                    <a id="swaa" rel="view" href="#view" class="link"></a>
                                </div>
                            </div></br>
                            <div class="row">
                                <div class="col-md-6">
                                    <label>RnD/Consultancy</label>
                                </div>
                                <div class="col-md-6">
                                    <a id="rca" rel="view" href="#view" class="link"></a>
                                </div>
                            </div></br>
                            <div class="row">
                                <div class="col-md-6">
                                    <label>Programs Attended</label>
                                </div>
                                <div class="col-md-6">
                                    <a id="paa" rel="view" href="#view" class="link"></a>
                                </div>
                            </div></br>
                            
                </div>
                    </div>
                </div>
            </div>          
    </div>
    <div id="view" class="box">
    </div>
    <script>
          
            
            function number(url, id)
            {
                $.getJSON(url, function(data) {
                    var count = Object.keys(data).length;
                    console.log(count);
                    $(id).text(count); 
                });
            }
            function deleteData(id,url, files) {
                    console.log("Elvis");
                    $.ajax(
                     {
                           url: "/" + url + "/" + files + "/" + id,
                           type: 'DELETE',
                           data: {
                                 "id": id,
                                },
                          success: function (){
                           console.log("it Works");
                           location.reload(true);
                     }
                   });
                }
               
           function create(rel, id, url, url1,url2, files)
            {
                const request = new XMLHttpRequest();
                request.open('GET', url);
                request.send(); 
                var titlemrg = new Array("Title","Grant Approved","Year Approved","Certificate","Report","Category","Authority");
                var titleprogatt = new Array("Type","Title"," College"," No of Days","Certificate","Sponsorship","Date");
                var titlesemwork = new Array("Title"," College"," No of Days","Certificate","Date","Type");
                var titlefdpsstp = new Array("Title"," College"," No of Days","Certificate","Sponsorship","Date");
                var titlesconjor = new Array("International/National","Title","Research Title","Author"," ISSN ","Date","DUI","Certificate");
                request.onload = function() {
                if (request.status === 200) {
                    console.log("Success"); 
                    data = JSON.parse(request.response);
                    var col = [];
                    var dict = {

                    }
                    for (var i = 0; i < data.length; i++) {
                        for (var key in data[i]) {
                            if (col.indexOf(key) === -1) {
                                console.log(key, dict.key);
                                col.push(dict.key);
                            }
                        }
                    }
                    
                    var table = document.createElement("table");
                    table.setAttribute("class", "table table-striped table-primary");
                    var tr = table.insertRow(-1); 
                    for (var i = 1; i < col.length; i++) {
                        var th = document.createElement("th");
                        th.innerHTML = col[i];
                        tr.appendChild(th);
                    }
                    var th = document.createElement("th");
                    th.innerHTML = 'Action';
                    tr.appendChild(th);
                    for (var i = 0; i < data.length; i++) {
                        tr = table.insertRow(-1);
                        var tabCell = ""
                        var id = 0;
                        for (var j = 1; j <= col.length; j++) {
                            tabCell = tr.insertCell(-1);
                            tabCell.innerHTML = data[i][col[j]];
                        }
                        id = data[i][col[0]];
                        tabCell.innerHTML = " <a class=\"btn btn-primary btn-xs\" href=\"" +url1 + "file-viewer/" + id + "\"><i class=\"fa fa-download\"></i></a> <a class=\"btn btn-primary btn-xs\" href=\"" + url1 + id + "\"><i class=\"fa fa-edit\"></i></a> <button class=\"btn btn-danger btn-xs\" onclick=\"deleteData("+ id + ","+ url2 + ","+ files + ")\" ><i class=\"fa fa-trash\"></i></button>";
                        
                    }
                    var divContainer = document.getElementById("view");
                    divContainer.innerHTML = "";
                    divContainer.appendChild(table);
                    } 
                };
            }   
            number('/fdp/files', '#fdpa');
            number('/sttp/files', '#sttpa');
            number('/conference/files', '#ca');
            number('/journal/files', '#ja');
            number('/semwork/files', '#swaa');
            number('/mrg/files', '#rca');
            number('/progatt/files', '#paa');      
            $('.link').click(function(){
                var id = $(this).attr("id");
                var rel = $(this).attr("rel");
                url = "";
                var files= "files";
                switch (id) {
                    case 'fdpa':
                        url = "/fdp/files";
                        url2 = "fdp";
                        url1 = "/fdp/";
                        break;
                    case 'sttpa':
                    url = "/sttp/files";
                        url2 = "sttp";
                        url1 = "/sttp/";
                        break;
                    case 'ca':
                    url = "/conference/files";
                        url2 = "conference";
                        url1 = "/conference/";
                        break;
                    case 'ja':
                    url = "/journal/files";
                        url2 = "journal";
                        url1 = "/journal/";
                        break;
                    case 'swaa':
                    url = "/semwork/files";
                        url2 = "semwork";
                        url1 = "/semwork/";
                        break;
                    case 'rca':
                    url = "/mrg/files";
                        url2 = "mrg";
                        url1 = "/mrg/";
                        break;
                    case 'paa':
                    url = "/progatt/files";
                        url2 = "progatt";
                        url1 = "/progatt/";
                        break;
                   
                }
                create(rel, id, url, url1,url2, files);
                $('#'+rel).slideToggle('fast');
            });
    </script>    
    <% include ./partials/bootjs %>
  </body>

</html>
